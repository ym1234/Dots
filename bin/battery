#!/bin/sh
# TODO(ym): POSIXify your shell scripts
while :; do
	. /sys/class/power_supply/BAT0/device/power_supply/BAT0/uevent
	[[ "$POWER_SUPPLY_STATUS" == "Discharging" ]] && {
		[[ "$POWER_SUPPLY_CAPACITY" -lt 5 ]] && {
			dunstify -r 220 -u critical -a "Status: Discharging ($POWER_SUPPLY_CAPACITY%)" "suspending in 5 seconds."

			sleep 5
			systemctl suspend
		}
		[[ "$POWER_SUPPLY_CAPACITY" -lt 15 ]] && [[ "$POWER_SUPPLY_CAPACITY" -gt 5 ]] &&  battery_level critical
	} || {
		[[ "$POWER_SUPPLY_STATUS" == "Full" ]] && battery_level
	}
	sleep 1m
done
